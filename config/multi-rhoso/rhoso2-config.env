#!/bin/bash
# RHOSO Instance 2 Configuration
# Source this file before deploying: source config/multi-rhoso/rhoso2-config.env

#############################################
# Multi-RHOSO Instance Identifier
#############################################
export RHOSO_INSTANCE_NAME=rhoso2

#############################################
# Namespace Configuration (MUST be different)
#############################################
export NAMESPACE=openstack2
export OPERATOR_NAMESPACE=openstack-operators

#############################################
# Shared Network Infrastructure (Same as RHOSO1)
#############################################
export NNCP_INTERFACE=enp6s0
export NNCP_BRIDGE=ospbr
export NETWORK_VLAN_START=20
export NETWORK_VLAN_STEP=1
export NETWORK_MTU=1500

#############################################
# Instance-Specific Network Addressing
# MUST be unique and non-overlapping with RHOSO Instance 1
#############################################
# Control Plane Network (different IPs on same network)
export NNCP_CTLPLANE_IP_ADDRESS_PREFIX=192.168.122
export NNCP_CTLPLANE_IP_ADDRESS_SUFFIX=20
export NNCP_DNS_SERVER=192.168.122.1
export NNCP_GATEWAY=192.168.122.1

# Internal API Network (VLAN 20 - different subnet)
export NETWORK_INTERNALAPI_ADDRESS_PREFIX=172.27.0

# Storage Network (VLAN 21 - different subnet)
export NETWORK_STORAGE_ADDRESS_PREFIX=172.29.0

# Tenant Network (VLAN 22 - different subnet)
export NETWORK_TENANT_ADDRESS_PREFIX=172.31.0

# Storage Management Network (VLAN 23 - different subnet)
export NETWORK_STORAGEMGMT_ADDRESS_PREFIX=172.32.0

# Designate Network (VLAN 25 - different subnet)
export NETWORK_DESIGNATE_ADDRESS_PREFIX=172.38.0

# Designate External Network (VLAN 26 - different subnet)
export NETWORK_DESIGNATE_EXT_ADDRESS_PREFIX=172.51.0

#############################################
# MetalLB IP Pools
# Note: Using separate range from openstack instance
# - openstack uses: 192.168.122.80-90
# - openstack2 uses: 192.168.122.110-120
# Both ranges are reachable from EDPM nodes (verified)
# Requires secondary IPs on CRC node for VLAN networks
#############################################
export METALLB_POOL=192.168.122.110-192.168.122.120

#############################################
# Data Plane Configuration
#############################################
export DATAPLANE_COMPUTE_IP=192.168.122.101
export DATAPLANE_COMPUTE_0_IP=192.168.122.101
export DATAPLANE_COMPUTE_0_NAME=edpm-compute-1
export DATAPLANE_TOTAL_NODES=1
export DATAPLANE_SSHD_ALLOWED_RANGES="['192.168.122.0/24']"

#############################################
# Network Isolation Settings
#############################################
export NETWORK_ISOLATION=true
export NETWORK_ISOLATION_USE_DEFAULT_NETWORK=true
export NETWORK_ISOLATION_IPV4=true
export NETWORK_ISOLATION_IPV6=false

#############################################
# Common Settings
#############################################
export PASSWORD=12345678
export TIMEOUT=500s

echo "âœ… RHOSO Instance 2 configuration loaded"
echo "   Instance Name: ${RHOSO_INSTANCE_NAME}"
echo "   Namespace: ${NAMESPACE}"
echo "   MetalLB Pool: ${METALLB_POOL}"
echo "   Internal API: ${NETWORK_INTERNALAPI_ADDRESS_PREFIX}.0/24"
echo "   Storage: ${NETWORK_STORAGE_ADDRESS_PREFIX}.0/24"
echo "   Tenant: ${NETWORK_TENANT_ADDRESS_PREFIX}.0/24"
